---
layout: blog
title: mysql日志【draft】
categories: [mysql, 数据库]
description: 了解下mysql日志，了解相应的调优概念
keywords: 日志, mysql
cnblogsClass: \[Markdown\],\[随笔分类\]数据库
oschinaClass: \[Markdown\],数据库,服务器,日常记录
csdnClass: \[Markdown\]
163Class: \[Markdown\]
51ctoClass: \[Markdown\]
chinaunixClass: \[Markdown\]
sinaClass: \[Markdown\]
---

# 日志文件
日志文件记录mysql数据库的各种类型活动。常用日志有：错误日志、查询日志、慢查询日志、二进制日志。

## 错误日志
错误日志文件对mysql的启动、运行、关闭过程进行了记录。

定位错误日志文件位置：
```mysql
mysql> show variables like 'log_error';
+---------------+--------+
| Variable_name | Value  |
+---------------+--------+
| log_error     | stderr |
+---------------+--------+
# stderr 代表错误输出；可在my.conf 设置log_error的存贮路径,如log_error = /data/mysql/mysql-error.log
```
当mysql数据库不能正常启动时，第一个必须查找的文件就是错误日志文件，该文件记录了出错信息。

## 慢查询日志
慢查询能为SQL语句的优化带来很好的帮助。

可以设一个阀值，将运行时间超过改制的所有SQL语句都记录到慢查询日志文件中。该阀值可以通过参数long_query_time来设置，默认值
为10，代表10秒。

```mysql
show VARIABLES like '%long%';
+-----------------+-----------+
| Variable_name   | Value     |
+-----------------+-----------+
| long_query_time | 10.000000 |
+-----------------+-----------+
SHOW variables like 'log_slow_queries';
```

配置：
```msyql
slow_query_log = 1     # 开启慢查询日志
long_query_time = 10   # 阀值时间，默认10秒
slow_query_log_file = /data/mysql/mysql-slow.log  # 慢查询日志存贮位置
log-queries-not-using-indexes # 记录没有使用索引的query
```

```mysql
show VARIABLES like '%slow_query%';
+---------------------+----------------------------------+
| Variable_name       | Value                            |
+---------------------+----------------------------------+
| slow_query_log      | ON                              |
| slow_query_log_file | /var/lib/mysql/msmaster-slow.log |
```

注意两点：
- 设置阀值后，mysql会记录运行时间超过该值的所有SQl语句，但对于运行时间正好等于阀值的情况并不会记录。即源代码里是判断大于long_query_time，而非大于等于。
- log-queries-not-using-indexes 记录没有使用索引的query

## 查询日志

## 二进制日志


