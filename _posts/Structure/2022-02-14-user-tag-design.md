# 基于标签维度的数据分析



用户打标签应用方案

## 业务背景

市场推广业务是七猫小说比较重要的部分，广告主需要评估推广活动实际的效果，来帮助运营进一步的分析。在媒体广告后台中会展示广告计划、广告创意相对应的转化效果数据，主要包括新增、活跃、推广消耗、成本等指标，这部分数据是对应系统最细的维度——渠道，每日都会生成日报表，另外广告主可以看到更高维度的转化效果数据，会由最低的渠道维度，往上汇总生成代理商、渠道组、媒体、类型以及每日汇总维度的报表。

### 业务需求

实际投放的广告计划、广告创意会有很多设置的属性，比如年龄阶段、广告版位、出价类型等标签。随着业务的发展，需将数据做更精细的标注，调整能够评估出各个标签对应的转化效果。因此需要每天生成对应的渠道标签转化效果数据，并且能够从渠道以及标签维度实现更高维度的转化效果数据展示以及支持多维度标签聚合。

图示转化示意图

了解了需求，下面就来看下需求实现上涉及的难点、问题：

- 渠道数据数据量较大（大宽表），目前日增120万，业务中经常查询一个月的数据，一个月就是3600万，目前存储MySQL中；
- 每个渠道对应标签的数量较大，比如当前使用广告计划下的版位、出价方式属性，未来会增加定向等其他的属性标签，并且标签还可以手动设置，所以标签的数量会越来越多；
- 渠道标签不是一成不变的，会随着推广策略的调整，发生变更添加；
- 系统实时输出计算结果，难度较大；？？？？

## 设计方案

在方案设计上需要注重的点主要是数据的查询效率及存贮效率。经过团队的讨论，主要确定在三个方向上的调研设计：

1. 大宽表记录每日的渠道标签
2. 渠道数据与渠道标签关联进行查询
3. 搜索引擎查询
4. bitmap索引标签查询

方案设计，优缺点

### 方案一 ：大宽表增加标签字段

在渠道数据表增加标签字段，假设有20个标签，我们的结构是这样：



图示



如果还是沿用关系数据库，查询结构是：

SELECT * FROM channel_data WHERE date = '2022-02-15' AND tag1='111' AND tag2='222' 





存在问题：

- 有新的标签添加









### 方案二： 渠道数据、标签维度关联查询



### 方案三：bitmap标签存储





## 调研实施

具体实施方案，优化点

## 总结

## 参考资料

https://zhuanlan.zhihu.com/p/68050217

https://www.modb.pro/db/40263